<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§∏‡§æ‡§á‡§ï‡•ã‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ (Comprehensive Psychometric Analysis - v6)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Custom Styles and Theme Setup */
        :root {
            --primary-color: #4f46e5; /* Indigo-600 */
            --background-light: #f9fafb;
            --surface-light: #ffffff;
            --text-light: #1f2937;
            --background-dark: #0f172a; /* Slate-900 */
            --surface-dark: #1e293b; /* Slate-800 */
            --text-dark: #e2e8f0;
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Light Mode */
        .light {
            background-color: var(--background-light);
            color: var(--text-light);
        }
        .light .card {
            background-color: var(--surface-light);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Dark Mode */
        .dark {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }
        .dark .card {
            background-color: var(--surface-dark);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.08);
        }
        
        /* Custom Rating Label Style */
        .rating-label {
            cursor: pointer;
            padding: 8px 10px;
            border-radius: 9999px; /* rounded-full */
            border: 1px solid #d1d5db; /* border-gray-300 */
            text-align: center;
            font-size: 0.75rem; /* text-xs */
            font-weight: 500; /* font-medium */
            transition: all 0.2s;
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .dark .rating-label { border-color: #4b5563; }
        
        /* Radio Checked State */
        .light input[type="radio"]:checked + .rating-label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
        .dark input[type="radio"]:checked + .rating-label {
            background-color: #6366f1; /* indigo-500 */
            color: white;
            border-color: #6366f1;
            transform: scale(1.05);
        }
        .rating-label:hover { background-color: #eff6ff; border-color: #bfdbfe; }
        .dark .rating-label:hover { background-color: #334155; border-color: #475569; }

        /* Loading Spinner */
        .loader {
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 9999px;
            overflow: hidden;
            position: sticky;
            top: 10px;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .dark .progress-bar-container { background-color: #374151; /* gray-700 */ }
        .progress-bar {
            height: 30px;
            background: linear-gradient(90deg, #4f46e5, #a855f7); /* Indigo to Purple */
            width: 0%;
            transition: width 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
        }
        
        /* NEW: Timer Style */
        #timer {
            position: fixed;
            top: 80px;
            right: 1rem;
            z-index: 20;
            background-color: var(--surface-light);
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        .dark #timer {
            background-color: var(--surface-dark);
            color: var(--text-dark);
            border-color: #374151;
        }
        
        /* NEW: Leaderboard Style */
        #leaderboardSection {
            transition: all 0.3s ease-in-out;
            border-top: 2px solid #e0e7ff;
            background: linear-gradient(180deg, #f9fafb 0%, #ffffff 100%);
        }
        .dark #leaderboardSection {
            border-top-color: #312e81;
            background: linear-gradient(180deg, #0f172a 0%, #1a233a 100%);
        }
        
        /* Print Styles */
        @media print {
            body { padding: 0; margin: 0; }
            .no-print { display: none !important; }
            .card { box-shadow: none; border: 1px solid #e5e7eb; }
            .print-container { max-width: 100% !important; margin: 0; padding: 0; }
            #resultsScreen { transform: scale(1) !important; display: block !important; }
            canvas { max-height: 400px !important; }
        }
        
        /* NEW: Certificate Template Style (More Professional) */
        #certificateTemplate {
            width: 1100px;
            height: 850px;
            background: #ffffff;
            color: #1f2937;
            font-family: 'Inter', sans-serif;
            border: 1px solid #d1d5db;
            padding: 40px;
            box-sizing: border-box;
            position: absolute;
            left: -9999px; /* Off-screen */
            top: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Guilloche pattern background */
            background-image: radial-gradient(#e0e7ff 1px, transparent 1px),
                              radial-gradient(#e0e7ff 1px, #ffffff 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            /* Inner border */
            box-shadow: inset 0 0 0 15px #4f46e5;
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8">

    <div class="fixed top-4 right-4 z-50 no-print flex gap-2">
        <button id="leaderboardToggleBtn" class="p-3 bg-white dark:bg-gray-800 rounded-full shadow-lg transition-all hover:scale-110">
            <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2Zm0 15a1 1 0 0 0 1-1v-3a1 1 0 0 0-2 0v3a1 1 0 0 0 1 1Zm-1-6a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm6-3.586a1 1 0 0 0-1.414 0L14 7.001l-2.586-2.587a1 1 0 0 0-1.414 0L7.001 7.001 4.415 4.415a1 1 0 0 0-1.414 1.414L5.587 8.415l2.587 2.586a1 1 0 0 0 1.414 0L14 8.415l2.586 2.586a1 1 0 0 0 1.414-1.414L15.415 7.001l2.586-2.587a1 1 0 0 0 0-1.414Z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
        </button>
        
        <label for="themeToggle" class="flex items-center cursor-pointer p-2 bg-white dark:bg-gray-800 rounded-full shadow-lg">
            <div class="relative">
                <input type="checkbox" id="themeToggle" class="sr-only">
                <div class="block bg-gray-300 dark:bg-gray-700 w-14 h-8 rounded-full"></div>
                <div class="dot absolute left-1 top-1 bg-white dark:bg-gray-200 w-6 h-6 rounded-full transition transform translate-x-0 dark:translate-x-full flex items-center justify-center">
                    <svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.485 5.148a.75.75 0 01-.527-.22L4.72 2.623a.75.75 0 111.06-1.06l2.238 2.238a.75.75 0 01-.527 1.298zM2.25 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75zM4.72 21.377a.75.75 0 011.06-1.06l2.238 2.238a.75.75 0 11-1.06 1.06L4.72 21.377zM12 18.75a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM16.515 5.148a.75.75 0 01-.527-1.298l2.238-2.238a.75.75 0 111.06 1.06l-2.238 2.238a.75.75 0 01-.527.22zM21 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010 1.5h2.25a.75.75 0 01.75.75zM18.742 21.377a.75.75 0 01-1.06-1.06l2.238-2.238a.75.75 0 111.06 1.06l-2.238 2.238zM12 7.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9z"/></svg>
                </div>
            </div>
        </label>
    </div>

    <div id="shareNotification" class="fixed top-20 right-4 z-50 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg transition-all transform translate-x-full opacity-0 no-print">
        ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ï‡•ç‡§≤‡§ø‡§™‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§è ‡§ó‡§è!
    </div>
    
    <div id="timer" class="hidden no-print">15:00</div>

    <main class="max-w-6xl mx-auto print-container">
        
        <header class="text-center mb-8 no-print">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-700 dark:text-indigo-400 mb-2">‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§∏‡§æ‡§á‡§ï‡•ã‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h1>
            <p class="text-xl font-medium text-gray-600 dark:text-gray-400">65 ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤</p>
        </header>

        <div id="ageInputScreen" class="card p-8 rounded-xl transition-all duration-500 transform scale-100 max-w-lg mx-auto no-print">
            <h2 class="text-2xl font-bold mb-6 text-center">‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§∞‡•á‡§Ç (Get Started)</h2>
            <p class="mb-4 text-center text-gray-700 dark:text-gray-300">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§Ø‡•Å (Age) ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§</p>
            <div class="flex flex-col items-center">
                <input type="number" id="userAge" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: 25" min="10" max="99" class="w-full sm:w-64 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white mb-6 text-center text-xl shadow-inner">
                <button id="startQuizBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-10 rounded-full transition duration-300 transform hover:scale-105 shadow-xl">
                    ‡§ï‡•ç‡§µ‡§ø‡§ú ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç (Start Quiz)
                </button>
            </div>
            
            <div id="leaderboardSection" class="mt-10 p-6 rounded-lg hidden">
                <h3 class="text-2xl font-bold text-center mb-4 text-indigo-600 dark:text-indigo-400">üèÜ ‡§ü‡•â‡§™ 5 ‡§∏‡•ç‡§ï‡•ã‡§∞ üèÜ</h3>
                <div id="leaderboardList" class="space-y-3">
                    <p class="text-center text-gray-500">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§¶‡•á‡§Ç ‡§î‡§∞ ‡§™‡§π‡§≤‡•á ‡§¨‡§®‡•á‡§Ç!</p>
                </div>
            </div>
        </div>

        <div id="quizScreen" class="hidden card p-4 sm:p-8 rounded-xl transition-all duration-500 transform scale-0 max-w-4xl mx-auto no-print">
            
            <div class="progress-bar-container mb-6">
                <div id="progressBar" class="progress-bar">0%</div>
            </div>
            
            <h2 class="text-3xl font-bold mb-6 text-center text-indigo-600 dark:text-indigo-400">65 ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§∏‡§µ‡§æ‡§≤</h2>
            <p class="mb-6 text-center text-gray-600 dark:text-gray-400">‡§π‡§∞ ‡§∏‡§µ‡§æ‡§≤ ‡§™‡§∞ 1 (‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§Ö‡§∏‡§π‡§Æ‡§§) ‡§∏‡•á 5 (‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡§π‡§Æ‡§§) ‡§§‡§ï ‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§¶‡•á‡§Ç‡•§</p>

            <form id="quizForm" class="space-y-8"></form>

            <div class="text-center mt-10">
                <button type="submit" id="submitQuizBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-10 rounded-full transition duration-300 transform hover:scale-105 shadow-xl">
                    ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¶‡•á‡§ñ‡•á‡§Ç (View Results)
                </button>
                <div id="error-message" class="text-red-500 mt-4 text-lg font-medium hidden">‚ö†Ô∏è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä 65 ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á ‡§¶‡§ø‡§Ø‡§æ ‡§π‡•à‡•§</div>
            </div>
        </div>

        <div id="loadingScreen" class="hidden card p-12 rounded-xl max-w-md mx-auto text-center no-print">
            <div class="loader w-16 h-16 border-8 border-t-8 border-gray-200 dark:border-gray-700 rounded-full mx-auto"></div>
            <h2 class="text-2xl font-bold mt-6 text-gray-800 dark:text-gray-200">‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</h2>
            <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§¨‡§®‡§æ‡§à ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§</p>
        </div>


        <div id="resultsScreen" class="hidden transition-all duration-500 transform scale-0">
            <h2 class="text-4xl font-extrabold mb-8 text-center text-green-600 dark:text-green-400">‡§Ü‡§™‡§ï‡§æ ‡§∏‡§æ‡§á‡§ï‡•ã‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h2>
            
            <div class="card p-8 rounded-xl mb-10 bg-gradient-to-br from-gray-900 to-gray-800 dark:from-gray-900 dark:to-black shadow-2xl">
                <p class="text-2xl font-bold text-center text-yellow-400">‡§Ü‡§™‡§ï‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ IQ ‡§∏‡•ç‡§ï‡•ã‡§∞ (‡§∏‡§Æ‡§Ø ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§)</p>
                <p id="iqValueText" class="text-8xl font-black text-center text-white my-4">120</p>
                <p id="iqRatingDisplay" class="text-3xl font-bold text-center text-yellow-400"></p>
                <p id="timeTakenDisplay" class="text-xl font-medium text-center text-gray-300 mt-4"></p> </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-12">
                <div class="card p-5 bg-indigo-50 dark:bg-indigo-900/50 rounded-xl text-center shadow-md border-t-4 border-indigo-500">
                    <p class="text-sm font-medium text-indigo-600 dark:text-indigo-300">IQ ‡§∏‡•ç‡§§‡§∞</p>
                    <p id="iqLevelText" class="text-3xl font-bold mt-1 text-indigo-800 dark:text-indigo-200">...</p>
                </div>
                <div class="card p-5 bg-purple-50 dark:bg-purple-900/50 rounded-xl text-center shadow-md border-t-4 border-purple-500">
                    <p class="text-sm font-medium text-purple-600 dark:text-purple-300">‡§Ü‡§™‡§ï‡§æ ‡§ë‡§∞‡§æ ‡§∞‡§Ç‡§ó</p>
                    <p id="auraColorText" class="text-3xl font-bold mt-1 text-purple-800 dark:text-purple-200">...</p>
                </div>
                <div class="card p-5 bg-amber-50 dark:bg-amber-900/50 rounded-xl text-center shadow-md border-t-4 border-amber-500">
                    <p class="text-sm font-medium text-amber-600 dark:text-amber-300">‡§ú‡•Ä‡§µ‡§® ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ</p>
                    <p id="priorityText" class="text-xl font-bold mt-1 text-amber-800 dark:text-amber-200">...</p>
                </div>
            </div>

            <h3 class="text-3xl font-bold border-b pb-3 mb-8 text-gray-800 dark:text-gray-200 text-center">‡§â‡§®‡•ç‡§®‡§§ ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏ (16 ‡§≤‡§ï‡•ç‡§∑‡§£)</h3>
            <div class="card w-full p-4 sm:p-8">
                <canvas id="barChartParameters"></canvas>
            </div>

            <h3 class="text-3xl font-bold border-b pb-3 mt-12 mb-8 text-gray-800 dark:text-gray-200 text-center">‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ (Detailed Analysis)</h3>
            <div class="space-y-6">
                <div class="card p-6 bg-yellow-50 dark:bg-yellow-900/50 border-l-4 border-yellow-500 shadow-sm">
                    <p class="font-bold text-xl text-yellow-600 dark:text-yellow-400">1. ‡§ë‡§∞‡§æ ‡§∞‡§Ç‡§ó ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§Ö‡§∞‡•ç‡§• / Detailed Aura Meaning</p>
                    <div id="auraMeaningText" class="mt-3 text-gray-700 dark:text-gray-300 space-y-2"></div>
                </div>
                <div class="card p-6 bg-gray-50 dark:bg-gray-700/50 border-l-4 border-blue-500 shadow-sm">
                    <p class="font-bold text-xl text-blue-600 dark:text-blue-400">2. ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ / Swabhav (Nature)</p>
                    <p id="natureText" class="mt-2 text-gray-700 dark:text-gray-300"></p>
                </div>
                <div class="card p-6 bg-gray-50 dark:bg-gray-700/50 border-l-4 border-purple-500 shadow-sm">
                    <p class="font-bold text-xl text-purple-600 dark:text-purple-400">3. ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§§‡§æ / Compatibility & Relationship Insight</p>
                    <p id="compatibilityText" class="mt-2 text-gray-700 dark:text-gray-300"></p>
                </div>
                <div class="card p-6 bg-gray-50 dark:bg-gray-700/50 border-l-4 border-red-500 shadow-sm">
                    <p class="font-bold text-xl text-red-600 dark:text-red-400">4. ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ ‡§∂‡•à‡§≤‡•Ä / Leadership & Control Style</p>
                    <p id="controlInsightText" class="mt-2 text-gray-700 dark:text-gray-300"></p>
                </div>
            </div>

            <div class="card p-8 rounded-xl mt-12 text-center no-print">
                <h3 class="text-3xl font-bold mb-6 text-gray-800 dark:text-gray-200">‡§Ö‡§™‡§®‡§æ ‡§∏‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§ü ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç</h3>
                <p class="mb-4 text-gray-600 dark:text-gray-400">‡§∏‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§ü ‡§™‡§∞ ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ PNG ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§<br>‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§≠‡•Ä ‡§∏‡§π‡•á‡§ú‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <input type="text" id="certificateNameInput" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ" class="w-full sm:w-80 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white text-center text-lg shadow-inner">
                    <button id="generateCertificateBtn" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-xl w-full sm:w-auto">
                        ‡§∏‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§ü ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                    </button>
                </div>
                <p id="certificateError" class="text-red-500 mt-3 hidden">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§</p>
            </div>
            
            <div class="mt-12 text-center space-y-4 sm:space-y-0 sm:space-x-4 no-print">
                 <button id="shareBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                    ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç (Share)
                </button>
                 <button id="savePdfBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-10 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                    PDF ‡§∏‡§π‡•á‡§ú‡•á‡§Ç (Save as PDF)
                </button>
                 <button onclick="window.location.reload();" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-10 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                    ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç (Retake Test)
                </button>
            </div>
        </div>

    </main>

    <div id="certificateTemplate">
        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzRmNDZlNSIgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIj48cGF0aCBkPSJNOS43NSA5Ljc1Yy43NS0uNzUgMS45Ny0uNzUgMi43NSAwbDQuNSA0LjVjLjc1Ljc1Ljc1IDEuOTcgMCAyLjc1cy0xLjk3Ljc1LTIuNzUgMGwtMS43NS0xLjc1di43NWMwIDEuMjQtLjc4IDIuMy0xLjg3IDIuNzNhLjc1Ljc1IDAgMCAxLS44OC0uODdsLjE3LTIuOTljLjAzLS41LS4xNy0uOTctLjU1LTEuMjlsLTIuNS0yLjVMOS43NSA5Ljc1Wk0xMiAxLjVBMS41IDEuNSAwIDAgMCAxMC41IDN2LjVjMCAuNDEuMzQuNzUuNzUuNzVoMS41YS43NS43NSAwIDAgMCAuNzUtLjc1VjNhMS41IDEuNSAwIDAgMC0xLjUtMS41Wk0xMiA2QTQgNCAwIDEgMCAxMiAxNGE0IDQgMCAwIDAgMC04Wm0wIDYuNWExLjUgMS41IDAgMSAxIDAtMyAxLjUgMS41IDAgMCAxIDAgM1ptNi43NS01LjI1YS43NS43NSAwIDAgMCAwIDEuNWgxLjVhLjc1Ljc5IDAgMCAwIDAtMS41aC0xLjVabS0xNSAwYS43NS43NSAwIDAgMCAwIDEuNWgxLjVhLjc1Ljc1IDAgMCAwIDAtMS41SDMuNzVabTE1IDQuNWEuNzUuNzUgMCAwIDAgMCAxLjVoMS41YS43NS43NSAwIDAgMCAwLTEuNWgtMS41Wm0tMTUgMGEuNzUuNzUgMCAwIDAgMCAxLjVoMS41YS43NS43NSAwIDAgMCAwLTEuNWgtMS41Wm0xNS4xOSAxLjc1YS43NS43NSAwIDAgMCAuMTkuNThsLjc1IDEuM2MuMzMuNTggLjA2IDEuMy0uNTIgMS42My0uNTguMzMtMS4zLjA2LTEuNjMtLjUybC0uNzUtMS4zYS43NS43NSAwIDAgMC0uMTktLjU4IDEuNSAxLjUgMCAwIDEtLjEyLS43NWMwLS4xMy4wMi0uMjUuMDUtLjM3YS43NS43NSAwIDAgMC43NSAxLjAyYzAgLjA0LS4wMS4wOC0uMDIuMTJhLjIzLjIzIDAgMCAwIC4wNC4yM2wuMDcuMTJabS0xMy4zOC0uNDZhLjc1Ljc1IDAgMCAwLjc1LTEuMDIuMDguMDggMCAwIDEtLjAyLS4xMmMtLjAxLS4wNS0uMDMtLjEtLjA0LS4yM2wtLjA3LS4xMmEuNzUuNzUgMCAwIDAtMS4xMy0uNDJsLS43NSAxLjNjLS4zMy41OC0uMDYgMS4zLjUyIDEuNjMuNTguMzMgMS4zLjA2IDEuNjMtLjUybC43NS0xLjNhLjc1Ljc1IDAgMCAwLS4wMi0uOTVabTEyLjE5IDYuNDdhLjc1Ljc1IDAgMCAwLTEuMDItLjc1bC0xLjMuNzVjLS41OC4zMy0xLjMuMDYtMS42My0uNTItLjMzLS41OC0uMDYtMS4zLjUyLTEuNjNsMS4zLS43NWEuNzUuNzUgMCAwIDAgLjUyLTEuMzMgMS41IDEuNSAwIDAgMS0uNzUtLjEyYy0uMTIgMC0uMjQuMDItLjM3LjA1YS43NS43NSAwIDAgMCAxLjAyLjc1bC4xMi4wMmMuMTEgMCAuMi0uMDMuMi0uMDRsLjEyLS4wN2ExLjQ5IDEuNDkgMCAwIDEgMi4wNiAxLjJ6bS0xNS4zOC0xLjExYS43NS43NSAwIDAgMCAuNTIgMS4zM2wxLjMuNzVjLjU4LjMzLjU4IDEuMDQgMCAxLjM3bC0xLjMuNzVjLS41OC4zMy0xLjMuMDYtMS42My0uNTJhLjc1Ljc1IDAgMCAwLS41Mi0xLjMzIDEuNSAxLjUgMCAwIDEgLjEyLS43NWMwIC4xMi0uMDIuMjUtLjA1LjM3YS43NS43NSAwIDAgMC0xLjAyLS43NWMtLjA0IDAtLjA4LjAxLS4xMi4wMmwtLjIyLjA0LS4xMi4wN2EuNzUuNzUgMCAwIDAgMS4wNCAxLjEzbC4wMi4wMVptNi4xOSA1YS43NS43NSAwIDAgMC0xLjA0IDEuMTNsLjAyLjAxbDEuMzIuNzZhLjc1Ljc1IDAgMCAwIDEuMDItLjc1bDEuMy0uNzVjLjU4LS4zMy41OC0xLjA0IDAtMS4zN2wtMS4zLS43NmEuNzUuNzUgMCAwIDAtMS4yNi4yOGwxLjI4LjczYzAgLjA1LS4wMS4wNi0uMDIuMDZzLS4wNC4wMy0uMDYuMDNsLS4wNC4wMi0uMDQuMDJILjA0bC0uMDIuMDJILjAzbC0uMDIuMDJILjAybC0uMDIuMDJoLS4wMmwtLjAyLjAyaC0uMDNsLS4wMi4wMmgtLjAybC0uMDIuMDJjLS4wMSAwLS4wMS4wMS0uMDIuMDFoLS4wMmwtLjAyLjAyaC0uMDJsLS4wMi4wMmgtLjAybC0uMDIuMDJoLS4wMmwtLjAyLjAyaC0uMDJjLS4wMSAwLS4wMi4wMS0uMDMuMDFoLS4wMmMtLjAxIDAtLjAyLjAxLS4wMy4wMWgtLjAybC0uMDMuMDFoLS4wMmMtLjAxIDAtLjAyLjAxLS4wMy4wMWgtLjAybC0uMDMuMDFoLS4wM2MtLjAxIDAtLjAyLjAxLS4wMy4wMWgtLjAzbC0uMDMuMDFoLS4wM2MtLjAxIDAtLjAyLjAxLS4wMy4wMWgtLjAzbC0uMDMuMDFoLS4wM2MtLjAxIDAtLjAyLjAxLS4wMy4wMWgtLjAzbC0uMDMuMDFoLS4wM2MtLjAxIDAtLjAyLjAxLS4wMy4wMWgtLjAzbC0uMDMuMDFoLS4wM2MtLjAxIDAtLjAzLjAxLS4wNC4wMWgtLjAzYy0uMDEgMC0uMDMuMDEtLjA0LjAxaC0uMDNjLS4wMSAwLS4wMy4wMS0uMDQuMDFoLS4wM2MtLjAxIDAtLjAzLjAxLS4wNC4wMWgtLjAzYy0uMDEgMC0uMDMuMDEtLjA0LjAxaC0uMDNjLS4wMSAwLS4wMy4wMS0uMDQuMDFoLS4wM2MtLjAxIDAtLjAzLjAxLS4wNC4wMWgtLjAzYy0uMDEgMC0uMDMuMDEtLjA0LjAxaC0uMDNzLS4wMy4wMS0uMDQuMDFoLS4wM2MtLjAyIDAtLjAzLjAxLS4wNS4wMWgtLjAzYy0uMDIgMC0uMDMuMDEtLjA1DigitalZMC0uMDQgMC0uMDYuMDEtLjA5LjAxaC0uMDRjLS4wMyAwLS4wNi4wMS0uMDkuMDFoLS4wNWMtLjAzIDAtLjA3LjAxLS4xLjAxaC0uMDVjLS4wMyAwLS4wNy4wMS0uMS4wMWgtLjA1Yy0uMDQgMC0uMDcuMDEtLjExLjAxaC0uMDVjLS4wNCAwLS4wOC4wMS0uMTIuMDFoLS4wNWMtLjA0IDAtLjA4LjAxLS4xMi4wMWgtLjA2Yy0uMDQgMC0uMDguMDEtLjEyLjAxaC0uMDJ6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtUnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==" alt="Seal">
            <div style="text-align: center;">
                <div style="font-size: 52px; font-weight: 800; color: #3730a3; letter-spacing: -1px;">
                    Certificate of Psychometric Analysis
                </div>
                <div style="font-size: 24px; color: #4b5563; margin-top: 10px;">
                    This certificate is proudly presented to
                </div>
            </div>
            <div style="width: 80px; height: 80px; background: radial-gradient(circle, #fde047, #eab308); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #78350f; font-weight: 800; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 4px solid #facc15;">
                IQ<br>SEAL
            </div>
        </div>
        
        <div id="cert-name" style="font-size: 60px; font-weight: 700; color: #1e293b; text-align: center; margin: 25px 0; border-bottom: 3px solid #d1d5db; padding-bottom: 10px; width: 80%;">
            User Name Here
        </div>
        <div style="font-size: 20px; color: #4b5563; text-align: center;">
            For successfully completing the v6 Comprehensive Psychometric Analysis
        </div>
        
        <div style="margin-top: 40px; width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <div style="background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 12px; padding: 25px; text-align: center;">
                <div style="font-size: 18px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Estimated IQ Score</div>
                <div id="cert-iq-score" style="font-size: 64px; font-weight: 900; color: #4f46e5; margin-top: 5px;">120</div>
                <div id="cert-iq-rating" style="font-size: 22px; font-weight: 600; color: #4f46e5;">(Above Average)</div>
            </div>
            <div style="background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 12px; padding: 25px; text-align: center;">
                <div style="font-size: 18px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Dominant Aura</div>
                <div id="cert-aura" style="font-size: 64px; font-weight: 900; color: #7c3aed; margin-top: 5px;">Blue</div>
                <div id="cert-aura-meaning" style="font-size: 22px; font-weight: 600; color: #7c3aed;">(‡§ú‡•ç‡§û‡§æ‡§®)</div>
            </div>
        </div>
        
        <div style="margin-top: 30px; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 12px; padding: 25px; width: 100%; text-align: center;">
            <div style="font-size: 18px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Key Personality Trait</div>
            <div id="cert-top-trait" style="font-size: 28px; font-weight: 700; color: #166534; margin-top: 10px;">
                Logical, Calm, and Resilient
            </div>
        </div>
        
        <div style="margin-top: auto; padding-top: 20px; width: 100%; display: flex; justify-content: space-between; align-items: flex-end;">
            <div style="text-align: center;">
                <div id="cert-date" style="font-size: 16px; font-weight: 500; color: #4b5563; border-bottom: 2px solid #6b7280; padding-bottom: 4px;">
                    Date Here
                </div>
                <div style="font-size: 14px; font-weight: 600; color: #6b7280; margin-top: 5px;">Date of Issue</div>
            </div>
            <div style="text-align: center;">
                <div style="font-family: 'cursive', sans-serif; font-size: 28px; color: #1e293b; border-bottom: 2px solid #6b7280; padding-bottom: 4px;">
                    Dr. A. Gemini
                </div>
                <div style="font-size: 14px; font-weight: 600; color: #6b7280; margin-top: 5px;">Chief Analyst, Psychometric Division</div>
            </div>
        </div>
    </div>


    <script>
        // --- v6: 65 Questions Data (45 original + 10 cognitive + 10 new personality) ---
        const questions = [
            // Trait Key: E=Extrovert, L=Logical, C=Calm, P=Practical, Ch=Chill, Ff=Future Focused, Ms=Material Success, Cp=Controlling Power, R=Relationship, A=Aura, Em=Empathy, Rs=Resilience
            // NEW Keys: IQC=IQ/Cognitive, ADP=Adaptability, DSC=Discipline, AMB=Ambition, PAT=Patience, FCS=Focus, SA=Social Acuity, CUR=Curiosity, SWA=Self-Awareness, LDR=Leadership, OPT=Optimism
            
            // --- Original 1-15 ---
            { id: 1, text: "‡§™‡§æ‡§∞‡•ç‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§Ü‡§Ø‡•ã‡§ú‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§®‡§æ ‡§Æ‡•Å‡§ù‡•á ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§", weights: { E: 1, A_Y: 1 } },
            { id: 2, text: "‡§Æ‡•Å‡§ù‡•á ‡§Ö‡§ï‡•á‡§≤‡•á ‡§∏‡§Æ‡§Ø ‡§¨‡§ø‡§§‡§æ‡§®‡§æ ‡§î‡§∞ ‡§Ö‡§™‡§®‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§™‡§∞ ‡§Æ‡§Ç‡§•‡§® ‡§ï‡§∞‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§π‡•à‡•§", weights: { E: -1, A_B: 1, SWA: 1 } },
            { id: 3, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§®‡§è ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { E: 1, R: 0.5, SA: 1 } },
            { id: 4, text: "‡§è‡§ï ‡§∂‡§æ‡§Ç‡§§ ‡§∂‡§æ‡§Æ ‡§è‡§ï ‡§∞‡•ã‡§Æ‡§æ‡§Ç‡§ö‡§ï ‡§≠‡•Ä‡§°‡§º-‡§≠‡§æ‡§°‡§º ‡§µ‡§æ‡§≤‡•Ä ‡§∞‡§æ‡§§ ‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•à‡•§", weights: { E: -1, C: 0.5, Rs: 0.5 } },
            { id: 5, text: "‡§ú‡§¨ ‡§Æ‡•à‡§Ç ‡§§‡§®‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•Ç‡§Å, ‡§§‡•ã ‡§Æ‡•à‡§Ç ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§∞‡§π‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { E: 1, R: -0.5 } },
            { id: 6, text: "‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§≤‡•á‡§§‡•á ‡§∏‡§Æ‡§Ø, ‡§Æ‡•à‡§Ç ‡§§‡§∞‡•ç‡§ï ‡§î‡§∞ ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { L: 1, P: 0.5 } }, // IQC q
            { id: 7, text: "‡§Æ‡•à‡§Ç ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§¨‡§π‡•Å‡§§ ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§≤‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { L: -1, R: 1, A_G: 1, Em: 1, SA: 1 } },
            { id: 8, text: "‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Å ‡§§‡§¨ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§π‡§≤ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç ‡§ú‡§¨ ‡§Ü‡§™ ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§è‡§ï ‡§§‡§∞‡§´ ‡§∞‡§ñ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§", weights: { L: 1, C: 0.5, Em: -1 } }, // IQC q
            { id: 9, text: "‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§Ü‡§≤‡•ã‡§ö‡§®‡§æ ‡§∏‡•á ‡§Æ‡•à‡§Ç ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§Ü‡§π‡§§ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { L: -1, R: -1, Rs: -1, SWA: -1 } },
            { id: 10, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§®‡§ú‡§º‡§∞‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§º ‡§ï‡§∞ ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { L: -1, R: 1, A_G: 1, Em: 1 } },
            { id: 11, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { C: 1, Cp: 0.5, Rs: 1, SWA: 1 } },
            { id: 12, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ö‡§æ‡§®‡§ï ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Ø‡§æ ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§≤‡•á ‡§≤‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { C: -1, ADP: 1 } },
            { id: 13, text: "‡§ó‡•Å‡§∏‡•ç‡§∏‡§æ ‡§Ü‡§®‡•á ‡§™‡§∞, ‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡§õ‡§§‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§¨‡§æ‡§§‡•á‡§Ç ‡§ï‡§π ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { C: -1, A_R: 1, Rs: -1 } },
            { id: 14, text: "‡§Æ‡•à‡§Ç ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§π‡§Æ‡•á‡§∂‡§æ ‡§¶‡•ã ‡§¨‡§æ‡§∞ ‡§∏‡•ã‡§ö‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { C: 1, L: 0.5, Ch: -1, PAT: 1 } },
            { id: 15, text: "‡§Æ‡•à‡§Ç ‡§∂‡§æ‡§Ç‡§§ ‡§î‡§∞ ‡§§‡§®‡§æ‡§µ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§∞‡§π‡§®‡•á ‡§ï‡•Ä ‡§ï‡§≤‡§æ ‡§ú‡§æ‡§®‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { C: 1, Ch: 1, Rs: 1, PAT: 1 } },
            
            // --- NEW: Cognitive/IQ Questions (10) ---
            { id: 16, text: "‡§Æ‡•Å‡§ù‡•á ‡§ú‡§ü‡§ø‡§≤ ‡§™‡§π‡•á‡§≤‡§ø‡§Ø‡§æ‡§Å (puzzles) ‡§î‡§∞ ‡§¶‡§ø‡§Æ‡§æ‡§ó‡•Ä ‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§≤‡§ù‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§ú‡§º‡§æ ‡§Ü‡§§‡§æ ‡§π‡•à‡•§", weights: { IQC: 2, L: 1, CUR: 1 } },
            { id: 17, text: "‡§Æ‡•à‡§Ç ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§Ø‡§æ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¢‡•Ç‡§Å‡§¢ ‡§≤‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { IQC: 2, L: 1 } },
            { id: 18, text: "‡§¨‡§π‡§∏ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø, ‡§Æ‡•à‡§Ç ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§π‡§Æ‡•á‡§∂‡§æ ‡§§‡§∞‡•ç‡§ï ‡§î‡§∞ ‡§§‡§•‡•ç‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { IQC: 1, L: 1, Em: -1 } },
            { id: 19, text: "‡§Æ‡•à‡§Ç ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ö‡•Ä‡§ú‡§º ‡§ï‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§§‡§∞‡•Ä‡§ï‡•á (mechanism) ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { IQC: 1, P: 0.5, CUR: 1 } },
            { id: 20, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•á ‡§Æ‡§® ‡§Æ‡•á‡§Ç 3D ‡§Ü‡§ï‡•É‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ò‡•Å‡§Æ‡§æ‡§ï‡§∞ (visualize) ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { IQC: 1, P: -1 } },
            { id: 21, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§ö‡•Ä‡§ú‡§º‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§µ‡•á ‡§ï‡•à‡§∏‡•Ä '‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç' ‡§® ‡§ï‡§ø ‡§µ‡•á ‡§ï‡•à‡§∏‡•Ä '‡§π‡•à‡§Ç'‡•§", weights: { P: -1, A_B: 1, IQC: -1 } }, // Re-purposed
            { id: 22, text: "‡§Æ‡•à‡§Ç ‡§≤‡§Ç‡§¨‡•Ä, ‡§ú‡§ü‡§ø‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (complex information) ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡•á ‡§î‡§∞ ‡§∏‡§Æ‡§ù‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { IQC: 2, L: 1, FCS: 1 } },
            { id: 23, text: "‡§Æ‡•à‡§Ç ‡§®‡§à ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§ì‡§Ç (new concepts) ‡§ï‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§§‡•á‡§ú‡§º‡•Ä ‡§∏‡•á ‡§∏‡•Ä‡§ñ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { IQC: 2, ADP: 1 } },
            { id: 24, text: "‡§Æ‡•à‡§Ç ‡§π‡§Æ‡•á‡§∂‡§æ ‡§∏‡§¨‡§∏‡•á ‡§ñ‡§∞‡§æ‡§¨ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ch: -1, P: 0.5, IQC: 1 } }, // Re-purposed
            { id: 25, text: "‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§ï‡•ã ‡§≤‡•á‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§Æ‡•à‡§Ç ‡§∏‡§≠‡•Ä ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ch: -1, L: 1, IQC: 1 } }, // Re-purposed
            
            // --- Original 20-30 ---
            { id: 26, text: "‡§Æ‡•à‡§Ç ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§≤‡•á‡§®‡•á ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§ö‡•Å‡§®‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { P: 1, Ch: 0.5, C: 0.5, Rs: 0.5 } },
            { id: 27, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§∞‡§æ‡§§ ‡§ï‡•ã ‡§õ‡•ã‡§ü‡•Ä-‡§õ‡•ã‡§ü‡•Ä ‡§¨‡§æ‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§≤‡•á‡§ï‡§∞ ‡§ú‡§æ‡§ó‡§§‡§æ ‡§∞‡§π‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ch: -1, L: 0.5, Rs: -1, FCS: -1 } },
            { id: 28, text: "‡§Æ‡•à‡§Ç '‡§ú‡•ã ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•ã‡§§‡§æ ‡§π‡•à' ‡§µ‡§æ‡§≤‡•Ä ‡§Æ‡§æ‡§®‡§∏‡§ø‡§ï‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ch: 1, Ms: -1, Rs: 1, OPT: 1 } },
            { id: 29, text: "‡§Æ‡•à‡§Ç ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ú‡§æ‡§®‡•á ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§ó‡§≤‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡§ø‡§≤ ‡§™‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§≤‡•á‡§§‡§æ‡•§", weights: { Ch: 1, C: 0.5, Rs: 1, OPT: 1 } },
            { id: 30, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§Ø‡§æ‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§â‡§®‡§Æ‡•á‡§Ç ‡§ñ‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ff: -1 } },
            { id: 31, text: "‡§Æ‡•á‡§∞‡§æ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§®‡§à ‡§Ø‡•ã‡§ú‡§®‡§æ‡§ì‡§Ç ‡§™‡§∞ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§∞‡§π‡§§‡§æ ‡§π‡•à‡•§", weights: { Ff: 1, Ms: 0.5, Rs: 0.5, AMB: 1 } },
            { id: 32, text: "‡§¨‡•Ä‡§§‡•Ä ‡§π‡•Å‡§à ‡§¨‡§æ‡§§‡•ã‡§Ç ‡§™‡§∞ ‡§™‡§õ‡§§‡§æ‡§µ‡§æ ‡§ï‡§∞‡§®‡§æ ‡§Æ‡•á‡§∞‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§µ‡§æ‡§≠‡§æ‡§µ‡§ø‡§ï ‡§π‡•à‡•§", weights: { Ff: -1, Ch: -0.5, Rs: -1, OPT: -1 } },
            { id: 33, text: "‡§Æ‡•à‡§Ç ‡§π‡§Æ‡•á‡§∂‡§æ ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ ‡§∞‡§π‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§Ü‡§ó‡•á ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§ó‡§æ‡•§", weights: { Ff: 1, E: 0.5, CUR: 1, OPT: 1 } },
            { id: 34, text: "‡§Æ‡•à‡§Ç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§ï‡•ç‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§∞‡§π‡§§‡§æ ‡§π‡•Ç‡§Å, ‡§® ‡§Ö‡§§‡•Ä‡§§, ‡§® ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ff: 0, C: 1, Ch: 1, Rs: 1 } },
            { id: 35, text: "‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø, ‡§Æ‡•à‡§Ç ‡§§‡§•‡•ç‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§°‡•á‡§ü‡§æ ‡§™‡§∞ ‡§≠‡§∞‡•ã‡§∏‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { P: 1, L: 0.5, IQC: 1 } }, // Re-purposed
            
            // --- NEW: Personality Questions (10) ---
            { id: 36, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•á ‡§¶‡•Ä‡§∞‡•ç‡§ò‡§ï‡§æ‡§≤‡§ø‡§ï ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø‡•ã‡§Ç (long-term goals) ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡§ñ‡•ç‡§§ ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ (strict routine) ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { DSC: 2, AMB: 1, FCS: 1 } },
            { id: 37, text: "‡§ú‡§¨ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å ‡§Ö‡§ö‡§æ‡§®‡§ï ‡§¨‡§¶‡§≤ ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Æ‡•à‡§Ç ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§®‡§à ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§¢‡§≤ ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { ADP: 2, C: 1, Ch: 1 } },
            { id: 38, text: "‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§ú‡§æ‡§Æ ‡§Ø‡§æ ‡§≤‡§Ç‡§¨‡•Ä ‡§≤‡§æ‡§á‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡•à‡§Ç ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ß‡•à‡§∞‡•ç‡§Ø ‡§ñ‡•ã ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { PAT: -2, C: -1 } },
            { id: 39, text: "‡§Æ‡•à‡§Ç ‡§è‡§ï ‡§ï‡§Æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡§§‡•á ‡§π‡•Ä ‡§µ‡§π‡§æ‡§Å ‡§ï‡•á ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§Æ‡§æ‡§π‡•å‡§≤ (social dynamics) ‡§ï‡•ã ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∏‡§Æ‡§ù ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { SA: 2, Em: 1, SWA: 1 } },
            { id: 40, text: "‡§Æ‡•à‡§Ç ‡§π‡§Æ‡•á‡§∂‡§æ ‡§®‡§à ‡§ö‡•Ä‡§ú‡•á‡§Ç ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§Ø‡§æ ‡§®‡§è ‡§ï‡•å‡§∂‡§≤ (skills) ‡§π‡§æ‡§∏‡§ø‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§Ö‡§µ‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§Æ‡•á‡§Ç ‡§∞‡§π‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { CUR: 2, Ff: 1 } },
            { id: 41, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç, ‡§∂‡§ï‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§∏‡§Æ‡§ù‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { SWA: 2, Em: 0.5, L: 0.5 } },
            { id: 42, text: "‡§≤‡•ã‡§ó ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§Æ‡•Å‡§ù‡•á ‡§Ö‡§™‡§®‡•Ä ‡§ü‡•Ä‡§Æ‡•ã‡§Ç ‡§ï‡§æ ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç, ‡§≠‡§≤‡•á ‡§π‡•Ä ‡§Æ‡•à‡§Ç ‡§™‡•Ç‡§õ‡•Ç‡§Å ‡§®‡§π‡•Ä‡§Ç‡•§", weights: { LDR: 2, Cp: 1, E: 0.5 } },
            { id: 43, text: "‡§Ö‡§∏‡§´‡§≤‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§µ‡§ú‡•Ç‡§¶, ‡§Æ‡•Å‡§ù‡•á ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§π‡•à ‡§ï‡§ø ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç ‡§ö‡•Ä‡§ú‡•á‡§Ç ‡§Æ‡•á‡§∞‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§π‡•ã‡§Ç‡§ó‡•Ä‡•§", weights: { OPT: 2, Rs: 1, Ch: 0.5 } },
            { id: 44, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•á ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ (driven) ‡§î‡§∞ ‡§Æ‡§π‡§§‡•ç‡§µ‡§æ‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡•Ä ‡§π‡•Ç‡§Å‡•§", weights: { AMB: 2, Ff: 1, Ms: 1, DSC: 1 } },
            { id: 45, text: "‡§Æ‡•à‡§Ç ‡§¨‡§ø‡§®‡§æ ‡§≠‡§ü‡§ï‡•á (distracted) ‡§π‡•Å‡§è ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§§‡§ï ‡§è‡§ï ‡§π‡•Ä ‡§ï‡§æ‡§Æ ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { FCS: 2, DSC: 1, Ch: -1 } },

            // --- Original 31-45 (remapped to 46-60) ---
            { id: 46, text: "‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡§¶‡•ã‡§®‡•ç‡§®‡§§‡§ø (promotion) ‡§î‡§∞ ‡§™‡•à‡§∏‡§æ ‡§Æ‡•á‡§∞‡•á ‡§≤‡§ø‡§è ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§π‡•à‡•§", weights: { Ms: 1, Cp: 0.5, A_R: 1, AMB: 1 } },
            { id: 47, text: "‡§Æ‡•à‡§Ç ‡§∏‡§Ç‡§§‡•Å‡§∑‡•ç‡§ü‡§ø ‡§î‡§∞ ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ï‡•ã ‡§ß‡§® ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§Æ‡§π‡§§‡•ç‡§µ ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ms: -1, C: 0.5, A_G: 1, Em: 0.5, SWA: 1 } },
            { id: 48, text: "‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•à‡§Ç ‡§Æ‡§π‡§Ç‡§ó‡•Ä ‡§ö‡•Ä‡§ú‡§º‡•á‡§Ç ‡§ñ‡§∞‡•Ä‡§¶‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ms: 1, E: 0.5 } },
            { id: 49, text: "‡§Æ‡•à‡§Ç ‡§ñ‡•Å‡§∂‡•Ä ‡§ï‡•ã ‡§Æ‡§æ‡§™‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•á ‡§∞‡§ø‡§∂‡•ç‡§§‡•ã‡§Ç ‡§ï‡•Ä ‡§ó‡§π‡§∞‡§æ‡§à ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Ms: -1, R: 1, Em: 1 } },
            { id: 50, text: "‡§è‡§ï ‡§∏‡§∞‡§≤ ‡§ú‡•Ä‡§µ‡§® ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§§‡§®‡§æ‡§µ ‡§ï‡§Æ ‡§π‡•ã, ‡§µ‡§π ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§Ü‡§Ø ‡§µ‡§æ‡§≤‡•á ‡§ú‡§ü‡§ø‡§≤ ‡§ú‡•Ä‡§µ‡§® ‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•à‡•§", weights: { Ms: -1, Ch: 1, C: 0.5, Rs: 0.5 } },
            { id: 51, text: "‡§Æ‡•à‡§Ç ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡§Æ‡•Ç‡§π ‡§Æ‡•á‡§Ç ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ ‡§ï‡§∞‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§≤‡•á‡§®‡§æ ‡§Æ‡•á‡§∞‡§æ ‡§ï‡§æ‡§Æ ‡§π‡•à‡•§", weights: { Cp: 1, E: 0.5, A_R: 1, LDR: 1 } },
            { id: 52, text: "‡§ú‡§¨ ‡§ï‡§æ‡§Æ ‡§Æ‡•á‡§∞‡•á ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§Æ‡•à‡§Ç ‡§®‡§ø‡§∞‡§æ‡§∂ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Cp: 1, C: -0.5, Rs: -1, ADP: -1 } },
            { id: 53, text: "‡§Æ‡•à‡§Ç ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•å‡§Ç‡§™‡§®‡•á ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§ï‡§æ‡§Æ ‡§ñ‡•Å‡§¶ ‡§ï‡§∞‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Cp: 1, P: 0.5, DSC: 1 } },
            { id: 54, text: "‡§ú‡§¨ ‡§Æ‡•à‡§Ç ‡§ï‡§ø‡§∏‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§™‡§æ‡§§‡§æ ‡§§‡•ã ‡§Æ‡•à‡§Ç ‡§¨‡•á‡§ö‡•à‡§® ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { Cp: 1, Ch: -0.5, ADP: -1 } },
            { id: 55, text: "‡§Æ‡•à‡§Ç ‡§Æ‡§æ‡§®‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§π‡§∞ ‡§ö‡•Ä‡§ú‡§º ‡§™‡§∞ ‡§Æ‡•á‡§∞‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§π‡•ã‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§", weights: { Cp: -1, Ch: 0.5, Rs: 1, ADP: 1 } },
            { id: 56, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§î‡§∞ ‡§à‡§Æ‡§æ‡§®‡§¶‡§æ‡§∞ ‡§π‡•Ç‡§Å, ‡§≠‡§≤‡•á ‡§π‡•Ä ‡§á‡§∏‡§∏‡•á ‡§Ö‡§∏‡§π‡§ú‡§§‡§æ ‡§π‡•ã‡•§", weights: { R: 1, L: -0.5, Em: 0.5, SWA: 1 } },
            { id: 57, text: "‡§∏‡§Ç‡§ò‡§∞‡•ç‡§∑ (conflict) ‡§π‡•ã‡§®‡•á ‡§™‡§∞, ‡§Æ‡•à‡§Ç ‡§∂‡§æ‡§Ç‡§§ ‡§∞‡§π‡§®‡•á ‡§î‡§∞ ‡§∏‡§Æ‡§ù‡•å‡§§‡•á ‡§ï‡§æ ‡§∞‡§æ‡§∏‡•ç‡§§‡§æ ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { R: 1, C: 0.5, Em: 0.5, Rs: 0.5, SA: 1, PAT: 1 } },
            { id: 58, text: "‡§Æ‡•à‡§Ç ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§Ü‡§≤‡•ã‡§ö‡§®‡§æ ‡§ï‡•ã ‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ (feedback) ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§≤‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { R: 1, L: 0.5, Rs: 1, SWA: 1 } }, // Removed IQ, added SWA
            { id: 59, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§Ø‡§π ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§Æ‡•á‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•ã‡§ö‡§§‡•á ‡§π‡•à‡§Ç‡•§", weights: { R: -1, Ch: -0.5, Em: 1, SWA: -1 } },
            { id: 60, text: "‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó ‡§§‡§∞‡§π ‡§ï‡•á ‡§¶‡•ã‡§∏‡•ç‡§§ ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§Æ‡•à‡§Ç ‡§π‡§∞ ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§ò‡•Å‡§≤‡§Æ‡§ø‡§≤ ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { R: 1, E: 0.5, A_Y: 1, Em: 0.5, SA: 1 } },
            
            // --- NEW: Final 5 Questions (for balance) ---
            { id: 61, text: "‡§Æ‡•à‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï (practical) ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ñ‡•ã‡§ú‡§®‡•á ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü ‡§π‡•Ç‡§Å‡•§", weights: { P: 1, Cp: 0.5, IQC: 1 } }, // Re-purposed
            { id: 62, text: "‡§Æ‡•à‡§Ç ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ (inspire) ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§â‡§®‡§ï‡§æ ‡§∏‡§∞‡•ç‡§µ‡§∂‡•ç‡§∞‡•á‡§∑‡•ç‡§† ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡•ã‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { LDR: 2, E: 1, OPT: 1, SA: 1 } },
            { id: 63, text: "‡§ú‡§¨ ‡§Æ‡•à‡§Ç ‡§ï‡•ã‡§à ‡§ó‡§≤‡§§‡•Ä ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å, ‡§§‡•ã ‡§Æ‡•à‡§Ç ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§â‡§∏‡•á ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§â‡§∏‡•á ‡§†‡•Ä‡§ï ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§", weights: { SWA: 1, Rs: 1, L: 0.5 } },
            { id: 64, text: "‡§Æ‡•à‡§Ç ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§∂‡§æ‡§µ‡§æ‡§¶‡•Ä (optimistic) ‡§π‡•Ç‡§Å, ‡§≠‡§≤‡•á ‡§π‡•Ä ‡§ö‡•Ä‡§ú‡•á‡§Ç ‡§Ö‡§≠‡•Ä ‡§Æ‡•Å‡§∂‡•ç‡§ï‡§ø‡§≤ ‡§π‡•ã‡§Ç‡•§", weights: { OPT: 2, Rs: 1, Ff: 0.5 } },
            { id: 65, text: "‡§Æ‡•à‡§Ç ‡§Æ‡§æ‡§®‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§® (discipline) ‡§™‡•ç‡§∞‡§§‡§ø‡§≠‡§æ (talent) ‡§∏‡•á ‡§ú‡§º‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§", weights: { DSC: 2, AMB: 1, L: 0.5 } }
        ];
        
        // --- v6: Core Trait Keys (26 total) ---
        const TRAITS = [
            'E', 'L', 'C', 'P', 'Ch', 'Ff', 'Ms', 'Cp', 'R', 'A_R', 'A_Y', 'A_G', 'A_B', 'Em', 'Rs', // Original 15
            'IQC', // Cognitive/IQ
            'ADP', 'DSC', 'AMB', 'PAT', 'FCS', 'SA', 'CUR', 'SWA', 'LDR', 'OPT' // New 10
        ];
        
        // --- Global Variables ---
        let userAge = 25; // Default age
        let chartObjects = {}; // To store chart instances for destruction
        let lastResults = {}; // To store results for sharing
        
        // --- NEW: Timer and Leaderboard ---
        let timerInterval;
        let timeTakenInSeconds = 0;
        const totalQuizTime = 900; // 15 ‡§Æ‡§ø‡§®‡§ü (900 ‡§∏‡•á‡§ï‡§Ç‡§°)
        const LEADERBOARD_KEY = 'psychometricQuizLeaderboard_v6';

        // --- Utility Functions ---

        // Function to toggle Dark/Light Mode
        function toggleTheme() {
            const html = document.documentElement;
            html.classList.toggle('dark');
            html.classList.toggle('light');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
            updateChartColors();
        }

        // Function to switch between the main views
        function switchView(targetView) {
            const screens = {
                'ageInput': document.getElementById('ageInputScreen'),
                'quiz': document.getElementById('quizScreen'),
                'loading': document.getElementById('loadingScreen'),
                'results': document.getElementById('resultsScreen')
            };

            for (const view in screens) {
                if (view === targetView) {
                    screens[view].classList.remove('hidden', 'scale-0');
                    screens[view].classList.add('scale-100');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    screens[view].classList.add('hidden', 'scale-0');
                    screens[view].classList.remove('scale-100');
                }
            }
        }

        // Function to generate the quiz form HTML
        function generateQuizForm() {
            const form = document.getElementById('quizForm');
            let html = '';
            const total = questions.length;

            questions.forEach(q => {
                html += `
                    <div class="p-5 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-800/50 transition duration-300 hover:shadow-lg">
                        <p class="font-semibold mb-4 text-lg text-gray-800 dark:text-gray-200">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${q.id}/${total}: ${q.text}</p>
                        <div class="flex flex-wrap justify-between gap-2 sm:gap-3">
                            <input type="radio" id="q${q.id}-1" name="q${q.id}" value="1" class="hidden" required>
                            <label for="q${q.id}-1" class="rating-label">1 - ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§Ö‡§∏‡§π‡§Æ‡§§</label>
                            <input type="radio" id="q${q.id}-2" name="q${q.id}" value="2" class="hidden">
                            <label for="q${q.id}-2" class="rating-label">2 - ‡§Ö‡§∏‡§π‡§Æ‡§§</label>
                            <input type="radio" id="q${q.id}-3" name="q${q.id}" value="3" class="hidden">
                            <label for="q${q.id}-3" class="rating-label">3 - ‡§§‡§ü‡§∏‡•ç‡§•</label>
                            <input type="radio" id="q${q.id}-4" name="q${q.id}" value="4" class="hidden">
                            <label for="q${q.id}-4" class="rating-label">4 - ‡§∏‡§π‡§Æ‡§§</label>
                            <input type="radio" id="q${q.id}-5" name="q${q.id}" value="5" class="hidden">
                            <label for="q${q.id}-5" class="rating-label">5 - ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡§π‡§Æ‡§§</label>
                        </div>
                    </div>
                `;
            });
            form.innerHTML = html;
        }

        // --- NEW: Timer Functions ---
        function startTimer() {
            document.getElementById('timer').classList.remove('hidden');
            let timeLeft = totalQuizTime;
            timeTakenInSeconds = 0;
            
            const timerEl = document.getElementById('timer');
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timeTakenInSeconds = totalQuizTime - timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerEl.textContent = '0:00';
                    // Auto-submit when time is up
                    document.getElementById('submitQuizBtn').click(); 
                }
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerEl.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                
            }, 1000);
        }

        // --- NEW: Leaderboard Functions ---
        function displayLeaderboard() {
            const leaderboardListEl = document.getElementById('leaderboardList');
            const leaderboardData = JSON.parse(localStorage.getItem(LEADERBOARD_KEY) || '[]');
            
            if (leaderboardData.length === 0) {
                leaderboardListEl.innerHTML = '<p class="text-center text-gray-500">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§¶‡•á‡§Ç ‡§î‡§∞ ‡§™‡§π‡§≤‡•á ‡§¨‡§®‡•á‡§Ç!</p>';
                return;
            }
            
            leaderboardListEl.innerHTML = ''; // Clear list
            
            leaderboardData.forEach((entry, index) => {
                const auraColorDot = entry.aura === 'Red' ? 'bg-red-500' :
                                     entry.aura === 'Yellow' ? 'bg-yellow-500' :
                                     entry.aura === 'Green' ? 'bg-green-500' : 'bg-blue-500';
                                     
                const el = document.createElement('div');
                el.className = 'flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm';
                el.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-xl font-bold w-6 text-indigo-600 dark:text-indigo-400">${index + 1}.</span>
                        <span class="w-4 h-4 rounded-full ${auraColorDot} mx-2 shadow-inner"></span>
                        <span class="font-semibold text-gray-800 dark:text-gray-200">${entry.name}</span>
                    </div>
                    <div class="text-right">
                        <span class="font-bold text-lg text-indigo-600 dark:text-indigo-400">IQ: ${entry.iq}</span>
                        <span class="block text-xs text-gray-500 dark:text-gray-400">${entry.date}</span>
                    </div>
                `;
                leaderboardListEl.appendChild(el);
            });
        }

        function addToLeaderboard(name, iq, auraMain) {
            if (!name || !iq || !auraMain) return;
            
            const leaderboardData = JSON.parse(localStorage.getItem(LEADERBOARD_KEY) || '[]');
            
            const newEntry = {
                name: name,
                iq: iq,
                aura: auraMain,
                date: new Date().toLocaleDateString('en-IN') // Indian date format
            };
            
            leaderboardData.push(newEntry);
            
            // Ranking System: Sort by IQ (descending)
            leaderboardData.sort((a, b) => b.iq - a.iq);
            
            // Keep only Top 5
            const top5 = leaderboardData.slice(0, 5);
            
            localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(top5));
            
            // Re-display the leaderboard on the home screen
            displayLeaderboard();
        }


        // --- v6: Core Calculation Logic (Heavily Updated) ---
        function calculateResults(timeTakenSeconds) {
            const form = document.getElementById('quizForm');
            const answers = new FormData(form);
            const rawScores = {};

            // Initialize raw scores
            TRAITS.forEach(t => rawScores[t] = 0);
            
            // 1. Calculate Raw Scores
            for (let i = 1; i <= questions.length; i++) {
                const answer = answers.get(`q${i}`);
                if (!answer) {
                    console.error(`Question ${i} is unanswered.`);
                    return null; 
                }

                const value = parseInt(answer);
                const q = questions.find(q => q.id === i);

                // Apply weights
                for (const trait in q.weights) {
                    let processedValue = (value - 3); // 3 is neutral (0 score)
                    if (trait === 'IQC') {
                        processedValue = value - 1; // 1 -> 0, 5 -> 4
                    }
                    rawScores[trait] += processedValue * q.weights[trait];
                }
            }

            // 2. Normalize and Calculate Percentage Pairs (0-100%)
            const params = {};
            
            const getMinMax = (traitKey) => {
                let minPossible = 0;
                let maxPossible = 0;
                questions.forEach(q => {
                    const weight = q.weights[traitKey] || 0;
                    if (traitKey === 'IQC') {
                        if (weight > 0) maxPossible += weight * 4; // Max score 4
                        // minPossible is 0
                    } else {
                        if (weight > 0) {
                            maxPossible += weight * 2; // Max push (rating 5 -> value 2)
                            minPossible += weight * -2; // Min push (rating 1 -> value -2)
                        } else if (weight < 0) {
                            maxPossible += weight * -2; // Max push (rating 1 -> value -2)
                            minPossible += weight * 2; // Min push (rating 5 -> value 2)
                        }
                    }
                });
                return { min: minPossible, max: maxPossible };
            };
            
            const normalize = (score, min, max) => {
                if (max === min) return 50;
                const pct = ((score - min) / (max - min)) * 100;
                return Math.max(0, Math.min(100, Math.round(pct)));
            };
            
            // Calculate percentages for all 16 advanced params
            TRAITS.forEach(trait => {
                if (trait !== 'IQC') { // IQC is handled separately
                    const minMax = getMinMax(trait);
                    params[trait] = normalize(rawScores[trait], minMax.min, minMax.max);
                }
            });

            // Calculate inverse traits for analysis
            params.Introvert = 100 - params.E;
            params.Emotional = 100 - params.L;
            params.Impulsive = 100 - params.C;
            params.Dreamer = 100 - params.P;
            params.Overthinker = 100 - params.Ch;
            params.Past = 100 - params.Ff;
            params.InnerPeace = 100 - params.Ms;
            
            // 3. v6: Advanced IQ Calculation (with Time)
            const iqMinMax = getMinMax('IQC');
            const iqPct = normalize(rawScores.IQC, iqMinMax.min, iqMinMax.max); // 0-100%
            const baseIQ = 70 + (iqPct / 100) * 75; // Base IQ (70-145) based on answers
            
            let timeBonus = 0;
            const timeFactor = 1 - (timeTakenSeconds / totalQuizTime); // 1 (fast) to 0 (slow)
            
            // High score + Fast = Bonus
            if (iqPct > 60 && timeFactor > 0.5) {
                timeBonus = (iqPct / 100) * (timeFactor * 15); // Max ~15 points bonus
            }
            // Low score + Very Fast = Penalty (Guessing)
            else if (iqPct < 40 && timeFactor > 0.8) {
                timeBonus = -10; // 10 points penalty
            }
            // High score + Slow = Small Bonus (Thoughtful)
            else if (iqPct > 70 && timeFactor < 0.3) {
                timeBonus = 5;
            }
            
            let agePenalty = 0;
            if (userAge > 30) {
                agePenalty = Math.floor((userAge - 30) / 5); // 1 point penalty every 5 years over 30
            }
            
            let calculatedIQ = Math.round(baseIQ + timeBonus - agePenalty);
            calculatedIQ = Math.max(75, Math.min(160, calculatedIQ)); // Clamp IQ
            
            let iqRating, iqLevelText;
            if (calculatedIQ >= 145) { iqRating = '‡§Ö‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ (Genius)'; iqLevelText = '‡§Ö‡§∏‡§æ‡§ß‡§æ‡§∞‡§£'; }
            else if (calculatedIQ >= 130) { iqRating = '‡§Ö‡§§‡§ø-‡§î‡§∏‡§§ (Very High)'; iqLevelText = '‡§¨‡§π‡•Å‡§§ ‡§â‡§ö‡•ç‡§ö'; }
            else if (calculatedIQ >= 115) { iqRating = '‡§î‡§∏‡§§ ‡§∏‡•á ‡§ä‡§™‡§∞ (Above Average)'; iqLevelText = '‡§â‡§ö‡•ç‡§ö'; }
            else if (calculatedIQ >= 90) { iqRating = '‡§î‡§∏‡§§ (Average)'; iqLevelText = '‡§î‡§∏‡§§'; }
            else if (calculatedIQ >= 80) { iqRating = '‡§î‡§∏‡§§ ‡§∏‡•á ‡§®‡•Ä‡§ö‡•á (Below Average)'; iqLevelText = '‡§î‡§∏‡§§ ‡§∏‡•á ‡§ï‡§Æ'; }
            else { iqRating = '‡§ï‡§Æ (Low)'; iqLevelText = '‡§®‡§ø‡§Æ‡•ç‡§®'; }
            
            // 4. Aura Calculation
            const auras = { Red: params.A_R, Yellow: params.A_Y, Green: params.A_G, Blue: params.A_B };
            let maxAura = 'Blue';
            let maxScore = -Infinity;
            for(const [key, value] of Object.entries(auras)) {
                if(value > maxScore) { maxScore = value; maxAura = key; }
            }
            let auraColor = `${maxAura} (${maxAura === 'Red' ? '‡§∂‡§ï‡•ç‡§§‡§ø' : maxAura === 'Yellow' ? '‡§ñ‡•Å‡§∂‡•Ä' : maxAura === 'Green' ? '‡§∏‡§Ç‡§§‡•Å‡§≤‡§®' : '‡§ú‡•ç‡§û‡§æ‡§®'})`;
            
            // 5. v6: Detailed Text Generation
            let natureText = '';
            if (params.E > 65 && params.C > 60) natureText = '‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§î‡§∞ ‡§ä‡§∞‡•ç‡§ú‡§æ‡§µ‡§æ‡§® (Energetic) ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§π‡•ã‡§®‡•á ‡§ï‡•á ‡§∏‡§æ‡§•-‡§∏‡§æ‡§• ‡§∂‡§æ‡§Ç‡§§ ‡§≠‡•Ä ‡§∞‡§π ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else if (params.Introvert > 65 && params.FCS > 60) natureText = '‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§ö‡§ø‡§Ç‡§§‡§®‡§∂‡•Ä‡§≤ ‡§î‡§∞ ‡§ó‡§π‡§® (Deep & Focused) ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§∏‡§Æ‡§ù‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§ï‡§æ‡§Æ ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else if (params.Impulsive > 60 && params.Emotional > 60) natureText = '‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§≠‡§æ‡§µ‡•Å‡§ï ‡§î‡§∞ ‡§Ü‡§µ‡•á‡§ó‡•Ä (Passionate) ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•á ‡§¶‡§ø‡§≤ ‡§∏‡•á ‡§ú‡•Ä‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§¨‡§π‡•Å‡§§ ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ (Sensitive) ‡§π‡•à‡§Ç‡•§';
            else if (params.L > 65 && params.P > 65 && params.DSC > 60) natureText = '‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•É‡§¢‡§º, ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§ø‡§§ ‡§î‡§∞ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ (Disciplined & Focused) ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§ì‡§∞ ‡§§‡§æ‡§∞‡•ç‡§ï‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§î‡§∞ ‡§¨‡§ø‡§®‡§æ ‡§µ‡§ø‡§ö‡§≤‡§ø‡§§ ‡§π‡•Å‡§è ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else if (params.ADP > 70 && params.OPT > 70) natureText = '‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§®‡•Ä‡§Ø (Adaptable) ‡§î‡§∞ ‡§Ü‡§∂‡§æ‡§µ‡§æ‡§¶‡•Ä (Optimistic) ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡•ã ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§π‡§Æ‡•á‡§∂‡§æ ‡§â‡§ú‡§≤‡§æ ‡§™‡§ï‡•ç‡§∑ ‡§¶‡•á‡§ñ‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else natureText = '‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§è‡§ï ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§ø‡§§ ‡§•‡•à‡§≤‡•Ä ‡§π‡•à, ‡§ú‡•ã ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§¨‡§π‡•Å‡§Æ‡•Å‡§ñ‡•Ä (versatile) ‡§π‡•à‡§Ç‡•§';

            let compatibilityText = '';
            if (params.Em > 65 && params.R > 60) compatibilityText = '‡§Ü‡§™ ‡§∞‡§ø‡§∂‡•ç‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ (Highly Compatible) ‡§î‡§∞ ‡§∏‡§π‡§æ‡§®‡•Å‡§≠‡•Ç‡§§‡§ø‡§™‡•Ç‡§∞‡•ç‡§£ (Empathetic) ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡•Ä ‡§§‡§æ‡§ï‡§§ ‡§Ü‡§™‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡§®‡•á ‡§î‡§∞ ‡§∏‡•Å‡§®‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à‡•§';
            else if (params.L > 60 && params.C > 60 && params.PAT > 50) compatibilityText = '‡§Ü‡§™ ‡§∞‡§ø‡§∂‡•ç‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü‡§§‡§æ (Clarity) ‡§ï‡•ã ‡§Æ‡§π‡§§‡•ç‡§µ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§°‡•ç‡§∞‡§æ‡§Æ‡§æ ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§ß‡•à‡§∞‡•ç‡§Ø‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ-‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® (Problem-Solving) ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else if (params.LDR > 65 || params.Cp > 65) compatibilityText = '‡§Ü‡§™ ‡§∞‡§ø‡§∂‡•ç‡§§‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞‡§§‡§æ (Independence) ‡§î‡§∞ ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•ã ‡§ê‡§∏‡•á ‡§∏‡§æ‡§•‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Æ‡§π‡§§‡•ç‡§µ‡§æ‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§';
            else compatibilityText = '‡§Ü‡§™ ‡§è‡§ï ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§∏‡§æ‡§•‡•Ä ‡§π‡•à‡§Ç, ‡§ú‡•ã ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§™‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§™‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§≤‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∏‡§Ç‡§ö‡§æ‡§∞ (clear communication) ‡§ï‡•ã ‡§Æ‡§π‡§§‡•ç‡§µ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            
            let controlInsightText = '';
            if (params.LDR > 70) controlInsightText = '‡§Ü‡§™‡§ï‡•Ä ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ ‡§∂‡•à‡§≤‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§ï (Inspirational) ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡•ã‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ (motivate) ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§è‡§ï ‡§∏‡•ç‡§µ‡§æ‡§≠‡§æ‡§µ‡§ø‡§ï ‡§®‡•á‡§§‡§æ ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§∞‡•ç‡§µ‡§∂‡•ç‡§∞‡•á‡§∑‡•ç‡§† ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else if (params.Cp > 70) controlInsightText = '‡§Ü‡§™‡§ï‡•Ä ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§∂‡§ï‡•ç‡§§‡§ø (Controlling Power) ‡§â‡§ö‡•ç‡§ö ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§ï‡•Å‡§∂‡§≤ ‡§î‡§∞ ‡§®‡§ø‡§∞‡•ç‡§£‡§æ‡§Ø‡§ï (decisive) ‡§π‡•à‡§Ç, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ü‡§™‡§ï‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§ú‡§º‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§¶‡•á‡§®‡•á ‡§î‡§∞ ‡§â‡§®‡§ï‡•Ä ‡§∞‡§æ‡§Ø ‡§ï‡§æ ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡§≤‡§æ ‡§∏‡•Ä‡§ñ‡§®‡•Ä ‡§π‡•ã‡§ó‡•Ä‡•§';
            else if (params.Cp > 40) controlInsightText = '‡§Ü‡§™‡§ï‡§æ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§∏‡•ç‡§§‡§∞ ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§™‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ü‡§™ ‡§∏‡§π‡§Ø‡•ã‡§ó (Collaboration) ‡§ï‡•ã ‡§≠‡•Ä ‡§Æ‡§π‡§§‡•ç‡§µ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§';
            else controlInsightText = '‡§Ü‡§™‡§ï‡•Ä ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡§Æ ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§™‡•ç‡§∞‡§µ‡§æ‡§π ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ö‡§≤‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§™‡§∞ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡•á‡•§ ‡§Ü‡§™ ‡§è‡§ï ‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§≤‡•á‡§Ø‡§∞ ‡§π‡•à‡§Ç‡•§';
            
            // v6: Expanded Aura Meanings
            let auraMeaningText = '';
            if(maxAura === 'Red') auraMeaningText = `
                <p class="mb-2"><strong>‡§≤‡§æ‡§≤ ‡§ë‡§∞‡§æ (‡§∂‡§ï‡•ç‡§§‡§ø, ‡§ú‡•Å‡§®‡•Ç‡§®, ‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ):</strong> ‡§Ü‡§™ ‡§è‡§ï ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§î‡§∞ ‡§Æ‡§π‡§§‡•ç‡§µ‡§æ‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§≤‡•á‡§®‡•á ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç ‡§°‡§∞‡§§‡•á ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§≠‡§æ‡§µ‡§ø‡§ï ‡§®‡•á‡§§‡§æ ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§∂‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç:</strong> ‡§Ü‡§™‡§ï‡§æ ‡§ú‡•Å‡§®‡•Ç‡§® ‡§Ü‡§™‡§ï‡•ã ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§∏‡§æ‡§π‡§∏‡•Ä, ‡§ä‡§∞‡•ç‡§ú‡§æ‡§µ‡§æ‡§® ‡§î‡§∞ ‡§ú‡§Æ‡•Ä‡§® ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á ‡§π‡•Å‡§è ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§ö‡•Ä‡§ú‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Å:</strong> ‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä ‡§Ø‡§π ‡§ú‡•Å‡§®‡•Ç‡§® ‡§Ü‡§™‡§ï‡•ã ‡§Ü‡§µ‡•á‡§ó‡•Ä (impulsive) ‡§Ø‡§æ ‡§Ö‡§ß‡•Ä‡§∞ (impatient) ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§Ö‡§™‡§®‡•Ä ‡§µ‡§ø‡§∏‡•ç‡§´‡•ã‡§ü‡§ï ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§∏‡•Ä‡§ñ‡•á‡§Ç‡•§</p>
                <p><strong>‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§§‡§æ:</strong> ‡§Ü‡§™ ‡§™‡•Ä‡§≤‡•á (Yellow) ‡§ë‡§∞‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï‡§§‡§æ ‡§î‡§∞ ‡§®‡•Ä‡§≤‡•á (Blue) ‡§ë‡§∞‡§æ ‡§ï‡•Ä ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§™‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>`;
            if(maxAura === 'Yellow') auraMeaningText = `
                <p class="mb-2"><strong>‡§™‡•Ä‡§≤‡§æ ‡§ë‡§∞‡§æ (‡§ñ‡•Å‡§∂‡•Ä, ‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï‡§§‡§æ, ‡§Ü‡§∂‡§æ‡§µ‡§æ‡§¶):</strong> ‡§Ü‡§™ ‡§è‡§ï ‡§â‡§ú‡•ç‡§ú‡•ç‡§µ‡§≤ ‡§î‡§∞ ‡§ï‡§∞‡§ø‡§∂‡•ç‡§Æ‡§æ‡§à ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§Ö‡§™‡§®‡•Ä ‡§ì‡§∞ ‡§Ü‡§ï‡§∞‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§∂‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç:</strong> ‡§Ü‡§™‡§ï‡•Ä ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Æ‡§ï ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§Ü‡§∂‡§æ‡§µ‡§æ‡§¶‡•Ä, ‡§ú‡§ø‡§ú‡•ç‡§û‡§æ‡§∏‡•Å (curious) ‡§î‡§∞ ‡§®‡§è ‡§µ‡§ø‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§Æ‡§π‡§æ‡§® ‡§∏‡§Ç‡§ö‡§æ‡§∞‡§ï (communicators) ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Å:</strong> ‡§Ü‡§™ ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ä‡§¨ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§è‡§ï ‡§ö‡•Ä‡§ú‡§º ‡§™‡§∞ ‡§ü‡§ø‡§ï‡•á ‡§∞‡§π‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§†‡§ø‡§®‡§æ‡§à ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä ‡§Ü‡§™ ‡§Ö‡§§‡§ø-‡§Ü‡§≤‡•ã‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï (over-critical) ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
                <p><strong>‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§§‡§æ:</strong> ‡§Ü‡§™ ‡§®‡•Ä‡§≤‡•á (Blue) ‡§ë‡§∞‡§æ ‡§ï‡•á ‡§ó‡§π‡§∞‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞‡§ï‡•ã‡§Ç ‡§î‡§∞ ‡§π‡§∞‡•á (Green) ‡§ë‡§∞‡§æ ‡§ï‡•á ‡§™‡•ã‡§∑‡§£ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>`;
            if(maxAura === 'Green') auraMeaningText = `
                <p class="mb-2"><strong>‡§π‡§∞‡§æ ‡§ë‡§∞‡§æ (‡§∏‡§Ç‡§§‡•Å‡§≤‡§®, ‡§â‡§™‡§ö‡§æ‡§∞, ‡§ï‡§∞‡•Å‡§£‡§æ):</strong> ‡§Ü‡§™ ‡§è‡§ï ‡§¶‡§Ø‡§æ‡§≤‡•Å ‡§î‡§∞ ‡§™‡•ã‡§∑‡§£ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§∏‡§¶‡•ç‡§≠‡§æ‡§µ (harmony) ‡§ï‡•ã ‡§Æ‡§π‡§§‡•ç‡§µ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§è‡§ï ‡§™‡•ç‡§∞‡§æ‡§ï‡•É‡§§‡§ø‡§ï ‡§∂‡§æ‡§Ç‡§§‡§ø‡§¶‡•Ç‡§§ ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§∂‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç:</strong> ‡§≤‡•ã‡§ó ‡§Ü‡§™‡§ï‡•Ä ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§∏‡§π‡§ú ‡§î‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§µ‡§´‡§æ‡§¶‡§æ‡§∞, ‡§ß‡•à‡§∞‡•ç‡§Ø‡§µ‡§æ‡§® ‡§î‡§∞ ‡§∏‡§π‡§æ‡§®‡•Å‡§≠‡•Ç‡§§‡§ø‡§™‡•Ç‡§∞‡•ç‡§£ (empathetic) ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Å:</strong> ‡§Ü‡§™ ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§‡•ã‡§Ç ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§∞‡§ñ‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§Ü‡§™ ‡§ñ‡•Å‡§¶ ‡§ï‡•ã ‡§â‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ (neglected) ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ '‡§®‡§æ' ‡§ï‡§π‡§®‡§æ ‡§∏‡•Ä‡§ñ‡•á‡§Ç‡•§</p>
                <p><strong>‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§§‡§æ:</strong> ‡§Ü‡§™ ‡§®‡•Ä‡§≤‡•á (Blue) ‡§î‡§∞ ‡§™‡•Ä‡§≤‡•á (Yellow) ‡§ë‡§∞‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ã‡§∑‡§£ ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø ‡§ï‡•Ä ‡§∏‡§∞‡§æ‡§π‡§®‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>`;
            if(maxAura === 'Blue') auraMeaningText = `
                <p class="mb-2"><strong>‡§®‡•Ä‡§≤‡§æ ‡§ë‡§∞‡§æ (‡§ú‡•ç‡§û‡§æ‡§®, ‡§∂‡§æ‡§Ç‡§§‡§ø, ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§ú‡•ç‡§û‡§æ‡§®):</strong> ‡§Ü‡§™ ‡§è‡§ï ‡§ó‡§π‡§∞‡•á ‡§µ‡§ø‡§ö‡§æ‡§∞‡§ï, ‡§∂‡§æ‡§Ç‡§§ ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£‡§æ‡§§‡•ç‡§Æ‡§ï ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§∏‡§ö‡•ç‡§ö‡§æ‡§à ‡§î‡§∞ ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ö‡•Ä‡§ú‡§º ‡§∏‡•á ‡§ú‡§º‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§∂‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç:</strong> ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡•Ä ‡§§‡§æ‡§ï‡§§ ‡§Ü‡§™‡§ï‡•Ä ‡§§‡§æ‡§∞‡•ç‡§ï‡§ø‡§ï ‡§∏‡•ã‡§ö ‡§î‡§∞ ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§à‡§Æ‡§æ‡§®‡§¶‡§æ‡§∞ ‡§î‡§∞ ‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü ‡§∏‡§Ç‡§ö‡§æ‡§∞‡§ï (communicator) ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§ú‡•ç‡§û‡§æ‡§®‡•Ä (intuitive) ‡§π‡•à‡§Ç‡•§</p>
                <p class="mb-2"><strong>‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Å:</strong> ‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä, ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§®‡§ú‡§º‡§∞‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§º ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç (Overthinking) ‡§î‡§∞ '‡§¶‡§ø‡§≤' ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø '‡§¶‡§ø‡§Æ‡§æ‡§ó' ‡§Æ‡•á‡§Ç ‡§ñ‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§π ‡§Ü‡§™‡§ï‡•ã ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§∏‡•á ‡§•‡•ã‡§°‡§º‡§æ ‡§¶‡•Ç‡§∞ (detached) ‡§¶‡§ø‡§ñ‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§</p>
                <p><strong>‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§§‡§æ:</strong> ‡§Ü‡§™ ‡§π‡§∞‡•á (Green) ‡§ë‡§∞‡§æ (‡§ú‡•ã ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§≤‡§æ‡§§‡•á ‡§π‡•à‡§Ç) ‡§î‡§∞ ‡§™‡•Ä‡§≤‡•á (Yellow) ‡§ë‡§∞‡§æ (‡§ú‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§•‡•ã‡§°‡§º‡•Ä ‡§Æ‡§∏‡•ç‡§§‡•Ä ‡§≤‡§æ‡§§‡•á ‡§π‡•à‡§Ç) ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§∏‡•á ‡§ò‡•Å‡§≤‡§§‡•á-‡§Æ‡§ø‡§≤‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>`;

            // Find top trait for certificate
            let topTrait = "‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ (Balanced)";
            const sortedParams = Object.entries(params)
                .filter(([key]) => !['A_R', 'A_Y', 'A_G', 'A_B'].includes(key) && params[key] > 75)
                .sort(([,a],[,b]) => b-a);
            if (sortedParams.length > 0) {
                const traitName = sortedParams[0][0];
                const traitMap = { 'L': '‡§§‡§æ‡§∞‡•ç‡§ï‡§ø‡§ï', 'Em': '‡§∏‡§π‡§æ‡§®‡•Å‡§≠‡•Ç‡§§‡§ø‡§™‡•Ç‡§∞‡•ç‡§£', 'LDR': '‡§®‡•á‡§§‡§æ', 'Rs': '‡§∏‡§π‡§®‡§∂‡•Ä‡§≤', 'DSC': '‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§ø‡§§', 'FCS': '‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§', 'OPT': '‡§Ü‡§∂‡§æ‡§µ‡§æ‡§¶‡•Ä' };
                topTrait = traitMap[traitName] ? `${traitMap[traitName]} (${traitName})` : `${traitName}`;
            }

            // Final Result Object
            lastResults = {
                iqValue: calculatedIQ,
                iqRating, iqLevelText, auraColor, auraMain: maxAura, auraMeaning: auraColor.split('(')[1].replace(')',''), topTrait,
                priorityText: params.Ms > params.InnerPeace ? '‡§≠‡•å‡§§‡§ø‡§ï ‡§∏‡§´‡§≤‡§§‡§æ' : '‡§Ü‡§Ç‡§§‡§∞‡§ø‡§ï ‡§∂‡§æ‡§Ç‡§§‡§ø',
                timeTakenText: `‡§ü‡•á‡§∏‡•ç‡§ü ${Math.floor(timeTakenSeconds / 60)} ‡§Æ‡§ø‡§®‡§ü ${timeTakenSeconds % 60} ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü‡•§`,
                natureText, compatibilityText, controlInsightText, auraMeaningText,
                
                // All 16 parameters for the bar chart
                barChartData: {
                    'Control Power': params.Cp,
                    'Creativity': Math.round((params.Dreamer + params.CUR) / 2), // v6: Updated logic
                    'Risk Appetite': Math.round((params.Impulsive + params.Ff) / 2),
                    'Energy Level': Math.round((params.E + params.Impulsive) / 2),
                    'Resilience': params.Rs,
                    'Empathy': params.Em,
                    'Adaptability': params.ADP,
                    'Discipline': params.DSC,
                    'Ambition': params.AMB,
                    'Patience': params.PAT,
                    'Focus': params.FCS,
                    'Social Acuity': params.SA,
                    'Curiosity': params.CUR,
                    'Self-Awareness': params.SWA,
                    'Leadership': params.LDR,
                    'Optimism': params.OPT
                }
            };
            return lastResults;
        }

        // --- v6: Chart.js Drawing Function (Bar Chart) ---
        function drawCharts(barChartData) {
            // Destroy old charts if they exist
            Object.values(chartObjects).forEach(chart => chart.destroy());
            
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#e2e8f0' : '#1f2937';
            const gridColor = isDark ? '#374151' : '#e5e7eb';
            
            const labels = Object.keys(barChartData);
            const data = Object.values(barChartData);
            
            // Dynamic colors for each bar
            const backgroundColors = data.map(value => {
                const intensity = value / 100;
                return `rgba(79, 70, 229, ${intensity * 0.8 + 0.2})`; // Indigo, more intense for higher values
            });
            const borderColors = data.map(() => `rgba(79, 70, 229, 1)`);

            const barChartCtx = document.getElementById('barChartParameters').getContext('2d');
            chartObjects.barChart = new Chart(barChartCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§∏‡•ç‡§ï‡•ã‡§∞',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar chart
                    responsive: true,
                    maintainAspectRatio: false, // Allow chart to fill container height
                    aspectRatio: 1, // Adjust based on 16 items
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: '‡§Ü‡§™‡§ï‡•á 16 ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏',
                            color: textColor,
                            font: { size: 18, weight: 'bold' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: gridColor },
                            ticks: { color: textColor, font: { size: 12 } }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: textColor, font: { size: 14 } } // Larger font for labels
                        }
                    }
                }
            });
            // Set explicit height for the canvas container based on 16 items
            document.getElementById('barChartParameters').style.height = '600px';
        }

        function updateChartColors() {
             const isDark = document.documentElement.classList.contains('dark');
             const textColor = isDark ? '#e2e8f0' : '#1f2937';
             const gridColor = isDark ? '#374151' : '#e5e7eb';

            if (chartObjects.barChart && chartObjects.barChart.options) {
                const chart = chartObjects.barChart;
                chart.options.plugins.title.color = textColor;
                chart.options.scales.x.ticks.color = textColor;
                chart.options.scales.y.ticks.color = textColor;
                chart.options.scales.x.grid.color = gridColor;
                chart.update();
            }
        }

        // --- Progress Bar Update Function ---
        function updateProgressBar() {
            const form = document.getElementById('quizForm');
            const checkedCount = form.querySelectorAll('input[type="radio"]:checked').length;
            const total = questions.length;
            const pct = Math.round((checkedCount / total) * 100);
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${pct}%`;
            progressBar.textContent = `${pct}% (${checkedCount}/${total})`;
        }
        
        // --- Share and Save Functions ---
        function showNotification() {
            const notification = document.getElementById('shareNotification');
            notification.classList.remove('translate-x-full', 'opacity-0');
            notification.classList.add('translate-x-0', 'opacity-100');
            
            setTimeout(() => {
                notification.classList.add('translate-x-full', 'opacity-0');
                notification.classList.remove('translate-x-0', 'opacity-100');
            }, 3000);
        }

        function shareResults() {
            const r = lastResults;
            const b = r.barChartData;
            const barDataSummary = Object.entries(b)
                .map(([key, value]) => `‚Ä¢ ${key}: ${value}%`)
                .join('\n');
                
            const summary = `
‡§Æ‡•á‡§∞‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§∏‡§æ‡§á‡§ï‡•ã‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ (v6):

‚ú® ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‚ú®
‚Ä¢ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ IQ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${r.iqValue} (${r.iqRating})
‚Ä¢ ‡§ë‡§∞‡§æ ‡§∞‡§Ç‡§ó: ${r.auraColor}
‚Ä¢ ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ: ${r.priorityText}
‚Ä¢ ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§∏‡§Æ‡§Ø: ${r.timeTakenText}

üìä 16 ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ üìä
${barDataSummary}

üí° ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø üí°
‚Ä¢ ‡§ë‡§∞‡§æ ‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§•: ${r.auraMeaningText.replace(/<[^>]*>/g, '').trim()}
‚Ä¢ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ: ${r.natureText}

‡§Ø‡§π ‡§ü‡•á‡§∏‡•ç‡§ü ‡§Ø‡§π‡§æ‡§Å ‡§¶‡•á‡§Ç: [Your App Link Here]
            `;
            
            navigator.clipboard.writeText(summary.trim()).then(() => {
                showNotification();
            }).catch(err => console.error('Failed to copy: ', err));
        }

        function saveAsPdf() {
            window.print();
        }
        
        // --- v6: Professional Certificate Generation Function ---
        async function generateCertificate() {
            const nameInput = document.getElementById('certificateNameInput');
            const errorEl = document.getElementById('certificateError');
            const name = nameInput.value.trim();
            
            if (!name) {
                errorEl.classList.remove('hidden');
                nameInput.focus();
                return;
            }
            errorEl.classList.add('hidden');

            const btn = document.getElementById('generateCertificateBtn');
            btn.textContent = '‡§ú‡§®‡§∞‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
            btn.disabled = true;

            // 1. Populate the hidden certificate template
            const r = lastResults;
            document.getElementById('cert-name').textContent = name;
            document.getElementById('cert-iq-score').textContent = r.iqValue;
            document.getElementById('cert-iq-rating').textContent = `(${r.iqRating})`;
            document.getElementById('cert-aura').textContent = r.auraMain;
            document.getElementById('cert-aura-meaning').textContent = `(${r.auraMeaning})`;
            document.getElementById('cert-top-trait').textContent = r.topTrait;
            document.getElementById('cert-date').textContent = new Date().toLocaleDateString('en-GB'); // dd/mm/yyyy

            // 2. Add to Leaderboard (Only on successful generation)
            addToLeaderboard(name, r.iqValue, r.auraMain);

            // 3. Use html2canvas to capture the template
            try {
                const canvas = await html2canvas(document.getElementById('certificateTemplate'), {
                    scale: 2 // Higher resolution
                });
                
                // 4. Create a download link
                const link = document.createElement('a');
                link.download = `${name.replace(/ /g, '_')}_Psychometric_Certificate.png`;
                link.href = canvas.toDataURL('image/png');
                link.click(); // Trigger download
                
            } catch (err) {
                console.error("Certificate generation failed:", err);
                alert("‡§∏‡§∞‡•ç‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§ü ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§");
            } finally {
                 // 5. Reset button
                btn.textContent = '‡§∏‡§∞‡•ç‡§üIFICATE ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç';
                btn.disabled = false;
            }
        }

        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Initial Theme Setup
            if (localStorage.getItem('theme') === 'dark' || (!('theme'in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                document.getElementById('themeToggle').checked = true;
            } else {
                document.documentElement.classList.add('light');
            }

            // 2. Theme Toggle Listener
            document.getElementById('themeToggle').addEventListener('change', toggleTheme);
            
            // 3. NEW: Leaderboard Toggle Listener
            document.getElementById('leaderboardToggleBtn').addEventListener('click', () => {
                document.getElementById('leaderboardSection').classList.toggle('hidden');
            });
            
            // 4. NEW: Display Leaderboard on Load
            displayLeaderboard();
            
            // 5. Generate Quiz Form
            generateQuizForm();
            
            // 6. Start Quiz Button
            document.getElementById('startQuizBtn').addEventListener('click', () => {
                const ageInput = document.getElementById('userAge');
                const age = parseInt(ageInput.value);

                if (age >= 10 && age <= 99) {
                    userAge = age; // Store the user's age
                    switchView('quiz');
                    startTimer(); // NEW: Start the timer
                } else {
                    ageInput.focus();
                }
            });

            // 7. Submit Quiz Button
            document.getElementById('submitQuizBtn').addEventListener('click', (e) => {
                e.preventDefault(); 
                
                // NEW: Stop the timer
                clearInterval(timerInterval);
                document.getElementById('timer').classList.add('hidden');
                
                const form = document.getElementById('quizForm');
                let allAnswered = true;
                for (let i = 1; i <= questions.length; i++) {
                    const selector = `input[name="q${i}"]:checked`;
                    if (!form.querySelector(selector)) {
                        allAnswered = false;
                        break;
                    }
                }
                
                if (!allAnswered) {
                    document.getElementById('error-message').classList.remove('hidden');
                    window.scrollTo({ top: document.getElementById('quizScreen').offsetTop, behavior: 'smooth' });
                    // Restart timer if they fail submission? No, let it be.
                    return;
                }
                document.getElementById('error-message').classList.add('hidden');
                
                switchView('loading');

                setTimeout(() => {
                    // NEW: Pass timeTakenInSeconds to results
                    const results = calculateResults(timeTakenInSeconds);
                
                    if (results) {
                        // Populate results
                        document.getElementById('iqValueText').textContent = results.iqValue;
                        document.getElementById('iqRatingDisplay').textContent = results.iqRating;
                        document.getElementById('timeTakenDisplay').textContent = results.timeTakenText; // NEW
                        document.getElementById('iqLevelText').textContent = results.iqLevelText;
                        document.getElementById('auraColorText').textContent = results.auraColor.split(' ')[0];
                        document.getElementById('priorityText').textContent = results.priorityText;
                        
                        document.getElementById('natureText').innerHTML = results.natureText;
                        document.getElementById('compatibilityText').innerHTML = results.compatibilityText;
                        document.getElementById('controlInsightText').innerHTML = results.controlInsightText;
                        document.getElementById('auraMeaningText').innerHTML = results.auraMeaningText; // v6: Now has HTML

                        switchView('results');
                        
                        // Draw bar chart *after* the view is visible
                        drawCharts(results.barChartData);
                    }
                }, 1500); // 1.5 second loading simulation
            });

            // 8. Add listeners for new buttons
            document.getElementById('quizForm').addEventListener('change', updateProgressBar);
            document.getElementById('shareBtn').addEventListener('click', shareResults);
            document.getElementById('savePdfBtn').addEventListener('click', saveAsPdf);
            document.getElementById('generateCertificateBtn').addEventListener('click', generateCertificate); 

            // Start on the age input screen
            switchView('ageInput');
        });
    </script>
</body>
</html>